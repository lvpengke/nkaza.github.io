<!DOCTYPE html>
<html lang="en-us">
<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="generator" content="Source Themes Academic 4.2.5">

  

  
  
  
  
  
    
    
    
  
  

  <meta name="author" content="Nikhil Kaza">

  
  
  
    
  
  <meta name="description" content="Finding density of places, service deserts using Google and OSRM.">

  
  <link rel="alternate" hreflang="en-us" href="https://sia.planning.unc.edu/post/2018-09-21-using-google-api-for-planning/using-google-api-for-planning/">

  


  

  

  

  

  

  

  
  
  
  <meta name="theme-color" content="#2962ff">
  

  
  
  
  
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/academicons/1.8.6/css/academicons.min.css" integrity="sha256-uFVgMKfistnJAfoCUQigIl+JfUaP47GrRKjf6CTPVmw=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.0/css/all.css" integrity="sha384-aOkxzJ5uQz7WBObEZcHvV5JvRW3TUc2rNPA7pe3AwnsUohiw1Vj2Rgx2KSOkF5+h" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.css" integrity="sha256-ygkqlh3CYSUri3LhQxzdcm0n1EQvH2Y+U5S2idbLtxs=" crossorigin="anonymous">

    
    
    
      
    
    
      
      
        
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css" crossorigin="anonymous" title="hl-light">
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/dracula.min.css" crossorigin="anonymous" title="hl-dark" disabled>
        
      
    

    

    

  

  
  
  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Lato:400,700|Merriweather|Roboto+Mono">
  

  
  
  
  <link rel="stylesheet" href="/css/academic.min.1e90017bce2dc39c3f107ce1a180f54f.css">

  
    
    
    
    
      
    
    
    
    <link rel="stylesheet" href="/css/academic.ab86083fffe10ac2d0af21549b7dd4cd.css">
  

  
  
    <script>
      window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
      ga('create', 'UA-121426944-1', 'auto');
      ga('set', 'anonymizeIp', true);
      ga('require', 'eventTracker');
      ga('require', 'outboundLinkTracker');
      ga('require', 'urlChangeTracker');
      ga('send', 'pageview');
    </script>
    <script async src="//www.google-analytics.com/analytics.js"></script>
    
    <script async src="https://cdnjs.cloudflare.com/ajax/libs/autotrack/2.4.1/autotrack.js" integrity="sha512-HUmooslVKj4m6OBu0OgzjXXr+QuFYy/k7eLI5jdeEy/F4RSgMn6XRWRGkFi5IFaFgy7uFTkegp3Z0XnJf3Jq+g==" crossorigin="anonymous"></script>
    
  
  

  

  <link rel="manifest" href="/site.webmanifest">
  <link rel="icon" type="image/png" href="/img/icon.png">
  <link rel="apple-touch-icon" type="image/png" href="/img/icon-192.png">

  <link rel="canonical" href="https://sia.planning.unc.edu/post/2018-09-21-using-google-api-for-planning/using-google-api-for-planning/">

  
  
  
  
    
  
  <meta property="twitter:card" content="summary_large_image">
  
  <meta property="twitter:site" content="@nikhil_kaza">
  <meta property="twitter:creator" content="@nikhil_kaza">
  
  <meta property="og:site_name" content="Nikhil Kaza">
  <meta property="og:url" content="https://sia.planning.unc.edu/post/2018-09-21-using-google-api-for-planning/using-google-api-for-planning/">
  <meta property="og:title" content="Using Google API for Planning | Nikhil Kaza">
  <meta property="og:description" content="Finding density of places, service deserts using Google and OSRM."><meta property="og:image" content="https://sia.planning.unc.edu/post/2018-09-21-using-google-api-for-planning/using-google-api-for-planning/featured.png">
  <meta property="og:locale" content="en-us">
  
  <meta property="article:published_time" content="2018-09-21T00:00:00&#43;00:00">
  
  <meta property="article:modified_time" content="2018-09-21T00:00:00&#43;00:00">
  

  

<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.0.3/cookieconsent.min.css">
<script src="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.0.3/cookieconsent.min.js"></script>
<script>
  window.addEventListener("load", function(){
    window.cookieconsent.initialise({
      "palette": {
        "popup": {
          "background": "#2962ff",
          "text": "#fff"
        },
        "button": {
          "background": "#fff",
          "text": "#2962ff"
        }
      },
      "theme": "classic",
      "content": {
        "message": "This website uses cookies to ensure you get the best experience on our website.",
        "dismiss": "Got it!",
        "link": "Learn more",
        "href": "/privacy/"
      }
    })});
</script>


  

  <title>Using Google API for Planning | Nikhil Kaza</title>

</head>
<body id="top" data-spy="scroll" data-target="#TableOfContents" data-offset="71" >
  <aside class="search-results" id="search">
  <div class="container">
    <section class="search-header">

      <div class="row no-gutters justify-content-between mb-3">
        <div class="col-6">
          <h1>Search</h1>
        </div>
        <div class="col-6 col-search-close">
          <a class="js-search" href="#"><i class="fas fa-times-circle text-muted" aria-hidden="true"></i></a>
        </div>
      </div>

      <div id="search-box">
        
        
        
      </div>

    </section>
    <section class="section-search-results">

      <div id="search-hits">
        
      </div>

    </section>
  </div>
</aside>


<nav class="navbar navbar-light fixed-top navbar-expand-lg py-0" id="navbar-main">
  <div class="container">

    
      <a class="navbar-brand" href="/">Nikhil Kaza</a>
      
      <button type="button" class="navbar-toggler" data-toggle="collapse"
              data-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
        <span><i class="fas fa-bars"></i></span>
      </button>
      

    
    <div class="collapse navbar-collapse" id="navbar">

      
      
      <ul class="navbar-nav ml-auto">
        

        

        
        
        
          
        

        <li class="nav-item">
          <a class="nav-link" href="/#about">
            
            <span>Home</span>
            
          </a>
        </li>

        
        

        

        
        
        
          
        

        <li class="nav-item">
          <a class="nav-link" href="/#posts">
            
            <span>Posts</span>
            
          </a>
        </li>

        
        

        

        
        
        
          
        

        <li class="nav-item">
          <a class="nav-link" href="/#projects">
            
            <span>Projects</span>
            
          </a>
        </li>

        
        

        

        
        
        
          
        

        <li class="nav-item">
          <a class="nav-link" href="/#featured">
            
            <span>Publications</span>
            
          </a>
        </li>

        
        

        

        
        
        
          
        

        <li class="nav-item">
          <a class="nav-link" href="/#teaching">
            
            <span>Teaching</span>
            
          </a>
        </li>

        
        

        

        
        
        
          
        

        <li class="nav-item">
          <a class="nav-link" href="/files/cv.pdf">
            
            <span>CV</span>
            
          </a>
        </li>

        
        

        

        
        
        
          
        

        <li class="nav-item">
          <a class="nav-link" href="/#contact">
            
            <span>Contact</span>
            
          </a>
        </li>

        
        

      

        

        

        

        
        <li class="nav-item">
          <a class="nav-link js-dark-toggle" href="#"><i class="fas fa-moon" aria-hidden="true"></i></a>
        </li>
        

      </ul>

    </div>
  </div>
</nav>


<article class="article" itemscope itemtype="http://schema.org/Article">

  













<div class="article-header d-xl-none">
  <div class="featured-image" style="background-image: url('/post/2018-09-21-using-google-api-for-planning/using-google-api-for-planning/featured_hua6df9699869a6261d235034852e22e39_500093_800x0_resize_lanczos_2.png');"></div>
  
</div>


<div class="container-fluid split-header d-none d-xl-block">
  <div class="row">
    <div class="col-6">
      <div class="split-header-content">
        <h1 itemprop="name">Using Google API for Planning</h1>

        

        



<meta content="2018-09-21 00:00:00 &#43;0000 UTC" itemprop="datePublished">
<meta content="2018-09-21 00:00:00 &#43;0000 UTC" itemprop="dateModified">

<div class="article-metadata">

  
  

  
  <span class="article-date">
    
    
      
    
    <time>Sep 21, 2018</time>
  </span>
  

  

  

  
  

  
  
  
  <span class="middot-divider"></span>
  <span class="article-categories">
    <i class="fas fa-folder"></i>
    
    <a href="/categories/r/">R</a>
    
  </span>
  
  

  

</div>


        








  










        
<div class="share-box" aria-hidden="true">
  <ul class="share">
    <li>
      <a class="twitter"
         href="https://twitter.com/intent/tweet?text=Using%20Google%20API%20for%20Planning&amp;url=https%3a%2f%2fsia.planning.unc.edu%2fpost%2f2018-09-21-using-google-api-for-planning%2fusing-google-api-for-planning%2f"
         target="_blank" rel="noopener">
        <i class="fab fa-twitter"></i>
      </a>
    </li>
    <li>
      <a class="facebook"
         href="https://www.facebook.com/sharer.php?u=https%3a%2f%2fsia.planning.unc.edu%2fpost%2f2018-09-21-using-google-api-for-planning%2fusing-google-api-for-planning%2f"
         target="_blank" rel="noopener">
        <i class="fab fa-facebook-f"></i>
      </a>
    </li>
    <li>
      <a class="linkedin"
         href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fsia.planning.unc.edu%2fpost%2f2018-09-21-using-google-api-for-planning%2fusing-google-api-for-planning%2f&amp;title=Using%20Google%20API%20for%20Planning"
         target="_blank" rel="noopener">
        <i class="fab fa-linkedin-in"></i>
      </a>
    </li>
    <li>
      <a class="weibo"
         href="http://service.weibo.com/share/share.php?url=https%3a%2f%2fsia.planning.unc.edu%2fpost%2f2018-09-21-using-google-api-for-planning%2fusing-google-api-for-planning%2f&amp;title=Using%20Google%20API%20for%20Planning"
         target="_blank" rel="noopener">
        <i class="fab fa-weibo"></i>
      </a>
    </li>
    <li>
      <a class="email"
         href="mailto:?subject=Using%20Google%20API%20for%20Planning&amp;body=https%3a%2f%2fsia.planning.unc.edu%2fpost%2f2018-09-21-using-google-api-for-planning%2fusing-google-api-for-planning%2f">
        <i class="fas fa-envelope"></i>
      </a>
    </li>
  </ul>
</div>


      </div>
    </div>
    <div class="col-6">
      <div class="split-header-image">
        <img src="/post/2018-09-21-using-google-api-for-planning/using-google-api-for-planning/featured_hua6df9699869a6261d235034852e22e39_500093_680x500_fill_q90_lanczos_smart1_2.png" itemprop="image" alt="">
        
      </div>
    </div>
  </div>
</div>

<div class="article-container d-xl-none">
  <h1 itemprop="name">Using Google API for Planning</h1>

  

  



<meta content="2018-09-21 00:00:00 &#43;0000 UTC" itemprop="datePublished">
<meta content="2018-09-21 00:00:00 &#43;0000 UTC" itemprop="dateModified">

<div class="article-metadata">

  
  

  
  <span class="article-date">
    
    
      
    
    <time>Sep 21, 2018</time>
  </span>
  

  

  

  
  

  
  
  
  <span class="middot-divider"></span>
  <span class="article-categories">
    <i class="fas fa-folder"></i>
    
    <a href="/categories/r/">R</a>
    
  </span>
  
  

  
    

  

</div>

  








  









</div>



  <div class="article-container">

    <div class="article-style" itemprop="articleBody">
      
<script src="/rmarkdown-libs/htmlwidgets/htmlwidgets.js"></script>
<script src="/rmarkdown-libs/jquery/jquery.min.js"></script>
<link href="/rmarkdown-libs/leaflet/leaflet.css" rel="stylesheet" />
<script src="/rmarkdown-libs/leaflet/leaflet.js"></script>
<link href="/rmarkdown-libs/leafletfix/leafletfix.css" rel="stylesheet" />
<script src="/rmarkdown-libs/Proj4Leaflet/proj4-compressed.js"></script>
<script src="/rmarkdown-libs/Proj4Leaflet/proj4leaflet.js"></script>
<link href="/rmarkdown-libs/rstudio_leaflet/rstudio_leaflet.css" rel="stylesheet" />
<script src="/rmarkdown-libs/leaflet-binding/leaflet.js"></script>
<script src="/rmarkdown-libs/leaflet-providers/leaflet-providers.js"></script>
<script src="/rmarkdown-libs/leaflet-providers-plugin/leaflet-providers-plugin.js"></script>
<link href="/rmarkdown-libs/HomeButton/home-button.css" rel="stylesheet" />
<script src="/rmarkdown-libs/HomeButton/home-button.js"></script>
<script src="/rmarkdown-libs/HomeButton/easy-button-src.min.js"></script>

<div id="TOC">
<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#legality">Legality</a></li>
<li><a href="#collect-points-of-interest-poi-from-google">Collect points of interest (POI) from Google</a></li>
<li><a href="#collect-streetview-images-from-google">Collect streetview images from Google</a></li>
<li><a href="#local-servers">Local servers</a></li>
<li><a href="#unstructured-data">Unstructured data</a></li>
<li><a href="#conclusions">Conclusions</a></li>
<li><a href="#acknowledgements">Acknowledgements</a></li>
</ul>
</div>

<div id="introduction" class="section level1">
<h1>Introduction</h1>
<p>Extracting data from un/semi/structured websites is becoming increasingly common place. Since data is collected, modified and refined continuously, it is increasingly useful to both serve them via web protocols rather than flat files that are downloaded. Furthermore, much of spatial data collection has become private, which also means that firms have stronger incentives to protect their datasets and curate what is available to the others. In other instances, the user or the analyst requires only a small section of the dataset. In these instances and others, data is served by a web-based protocol. Harvesting data usually takes the form of automating the process of sending requests to the webserver and parsing the output to extract relevant data for storage and analysis.</p>
</div>
<div id="legality" class="section level1">
<h1>Legality</h1>
<p>Different jurisdictions have different legal restrictions and permissions on web scraping. There are also end user agreements that prevent certain actions (storage, retrieval, replication etc.). Please make sure that you are aware of these before attempting to make a local copy of the data that might be privately owned.</p>
<p>In general, scraping requires automated and repeated requests to the server. As long as these requests are not a disruptive rate, it is unlikely that you will run afoul of legality. Local data storage and replication of services is an entirely different ball game. Please consult a lawyer.</p>
<p>Many public and government websites are also now serving up data using web protocols. It is, therefore, useful to learn how to parse the outputs of these requests. In some instances, private firms such as Google, Baidu, Instagram etc. also provide Application Programming Interfaces (API) that serve data in a structured format. In these instances, subject to end user agreements, rate limits and daily quotas, restrictions on storage and transfer, it may be possible to access datasets that are otherwise unavailable.</p>
</div>
<div id="collect-points-of-interest-poi-from-google" class="section level1">
<h1>Collect points of interest (POI) from Google</h1>
<p>Points of interest are both businesses as well as other locations from around the US that allow us to understand the neighborhood character. Google has one of the largest collections of these to enable their maps and directions interfaces. They are of different types from ‘accounting’ to ‘zoo’ (see <a href="https://developers.google.com/places/web-service/supported_types">documentation</a>). In this post, we will use Google PLACE API as a example to scrape the resturants around UNC-Chapel Hill. For more detailed information about how the API works, Please see the <a href="https://developers.google.com/places/web-service/search">documentation</a>.</p>
<div id="acquiring-api-keys." class="section level2">
<h2>Acquiring API keys.</h2>
<p>Every request to API requires a key so the website can authorize and control the how much and who can access the information. To acquire a key from Google you need to follow <a href="https://developers.google.com/places/web-service/get-api-key">these instructions</a>:</p>
<p>According to the recent Google policy <a href="https://developers.google.com/places/web-service/usage-and-billing">documentation</a> that only</p>
<blockquote>
<p>address_component, adr_address, alt_id, formatted_address, geometry, icon, id, name, permanently_closed, photo, place_id, scope, type, url, utc_offset, vicinity. If you are interested for other information you need to enable billing option to be charged.</p>
</blockquote>
</div>
<div id="scraping" class="section level2">
<h2>Scraping</h2>
<p>Once you acquired the API key, you need to follow a few steps iteratively to get at the results.</p>
<p>The steps are:</p>
<ol style="list-style-type: decimal">
<li>Intialise your R session</li>
<li>Set the parameters of the query</li>
<li>Send the query repreatedly to get all the results</li>
<li>Cleaning and exporting the data</li>
<li>Visualize the result</li>
</ol>
<p>The two main packages, we are going to use for scraping the Google is <a href="https://CRAN.R-project.org/package=rjson">RCurl</a> and <a href="https://CRAN.R-project.org/package=jsonlite">jsonlite</a>. Install them, if necessary and intialise them into the library.</p>
<p>Curl is a command line tool that allows us to transfer data especially over the web. Rcurl is an interface for that tool. Because the result of the API query is formatted in JavaScript Object Notation (JSON), we use jsonlite to parse it easily. JSON is lightweight data-interchange format.</p>
<p>###Intialise your R session</p>
<pre class="r"><code>##################### USE YOUR OWN KEY #########################
key = &quot;_YOUR_KEY_HERE_&quot;



library(RCurl)
library(tidyverse) 
library(sf)
################################################################</code></pre>
<div id="set-parameters" class="section level3">
<h3>Set parameters</h3>
<p>According to the <a href="https://developers.google.com/places/web-service/search">API documentation</a>, we need to set a number of parameters to send the request to API. First, we will use the “round buffer” API to search all the restraunts within 2000 meters distance around UNC-Chapel Hill. You can extract the coordinates from <a href="https://www.gps-coordinates.net/" class="uri">https://www.gps-coordinates.net/</a> by searching for “Old Well”. The coordinates extracted are:Latitude: 35.912073 | Longitude: -79.05123. You can also use Google maps, select a point and right click to get to ‘What is here?’ and copy the latitude and logitude.</p>
<blockquote>
<p>The Places API allows you to query for place information on a variety of categories, such as: establishments, prominent points of interest, geographic locations, and more. You can search for places either by proximity or a text string. A Place Search returns a list of places along with summary information about each place; additional information is available via a Place Details query.</p>
</blockquote>
<p>There are three type of requests in Places API, “Find Places”,“Nearby Search”,“Text Search”
To scrape POI based on the location criteria, the request need to be use here is “Nearby Search”, according to the document:</p>
<blockquote>
<p>A Nearby Search lets you search for places within a specified area. You can refine your search request by supplying keywords or specifying the type of place you are searching for.
A Nearby Search request is an HTTP URL of the following form:
<a href="https://maps.googleapis.com/maps/api/place/nearbysearch/output?parameters" class="uri">https://maps.googleapis.com/maps/api/place/nearbysearch/output?parameters</a></p>
</blockquote>
<p><a href="https://maps.googleapis.com/maps/api/place/nearbysearch/json?location=-33.8670522,151.1957362&amp;radius=1500&amp;type=restaurant&amp;keyword=cruise&amp;key=YOUR_API_KEY" class="uri">https://maps.googleapis.com/maps/api/place/nearbysearch/json?location=-33.8670522,151.1957362&amp;radius=1500&amp;type=restaurant&amp;keyword=cruise&amp;key=YOUR_API_KEY</a></p>
<pre class="r"><code>location &lt;- &quot;35.912073,-79.05123&quot;   #range,Latitude and Longitude as a string.
radius &lt;- 2000 # max is 50000
type &lt;- &quot;restaurant&quot; ### set the type of poi, for supported types: https://developers.google.com/places/web-service/supported_types</code></pre>
</div>
<div id="querying-the-api" class="section level3">
<h3>Querying the API</h3>
<p>Querying the API is simply passing the url string to the server. <code>paste</code> and <code>paste0</code> are quite useful for constructing these queries</p>
<pre class="r"><code>searchURL &lt;- paste(&quot;https://maps.googleapis.com/maps/api/place/nearbysearch/json?key=&quot;,
                      key,
                      &quot;&amp;location=&quot;,location,
                      &quot;&amp;radius=&quot;,radius,
                      &quot;&amp;type=&quot;,type,
                      sep=&quot;&quot;)


result &lt;- getURL(url = URLencode(searchURL),ssl.verifypeer = FALSE)

library(jsonlite)

tmp &lt;- jsonlite::fromJSON(result)
str(tmp, max.level = 2) # Setting max.level so that it won&#39;t overwhelm the page. Feel free to explore.
# List of 4
#  $ html_attributions: list()
#  $ next_page_token  : chr &quot;CpQECAIAAI9Ge4b0W63AifpB91_oRYVkRK76Hg_ZRdUlgIGrSl21jRqgaviBHAZscnGcsUmpB5-LutKESkAS-mwQG7OQuH6p-u9JXryXEiLxDgS&quot;| __truncated__
#  $ results          :&#39;data.frame&#39;:    20 obs. of  15 variables:
#   ..$ geometry          :&#39;data.frame&#39;:    20 obs. of  2 variables:
#   ..$ icon              : chr [1:20] &quot;https://maps.gstatic.com/mapfiles/place_api/icons/restaurant-71.png&quot; &quot;https://maps.gstatic.com/mapfiles/place_api/icons/restaurant-71.png&quot; &quot;https://maps.gstatic.com/mapfiles/place_api/icons/restaurant-71.png&quot; &quot;https://maps.gstatic.com/mapfiles/place_api/icons/restaurant-71.png&quot; ...
#   ..$ id                : chr [1:20] &quot;a936effd6a88935a17a342ff6a31d553ea540fe2&quot; &quot;57c756dbf2b2a47bf42f5653b62bd3b5af422673&quot; &quot;844be2aa98f4d2e5315d1bfbbe40dcc45e5eb897&quot; &quot;edb90eeb4b89849de121553f72aaa767362bb1c1&quot; ...
#   ..$ name              : chr [1:20] &quot;Amante Gourmet Pizza - Carrboro&quot; &quot;Top of the Hill Restaurant &amp; Brewery&quot; &quot;Vimala&#39;s Curryblossom Cafe&quot; &quot;Acme Food &amp; Beverage Co&quot; ...
#   ..$ opening_hours     :&#39;data.frame&#39;:    20 obs. of  1 variable:
#   ..$ photos            :List of 20
#   ..$ place_id          : chr [1:20] &quot;ChIJd27Voh7DrIkRopK4FUbe_ys&quot; &quot;ChIJiU9Og-fCrIkRlhl07CZ-Jso&quot; &quot;ChIJjcPPk-HCrIkR3tF9XFCWMvI&quot; &quot;ChIJl8i1WhnDrIkRa2K08FWRADs&quot; ...
#   ..$ plus_code         :&#39;data.frame&#39;:    20 obs. of  2 variables:
#   ..$ price_level       : int [1:20] 2 2 2 3 2 2 2 2 1 2 ...
#   ..$ rating            : num [1:20] 3.7 4.3 4.4 4.4 4.2 4.6 4 4.6 3.7 3.6 ...
#   ..$ reference         : chr [1:20] &quot;ChIJd27Voh7DrIkRopK4FUbe_ys&quot; &quot;ChIJiU9Og-fCrIkRlhl07CZ-Jso&quot; &quot;ChIJjcPPk-HCrIkR3tF9XFCWMvI&quot; &quot;ChIJl8i1WhnDrIkRa2K08FWRADs&quot; ...
#   ..$ scope             : chr [1:20] &quot;GOOGLE&quot; &quot;GOOGLE&quot; &quot;GOOGLE&quot; &quot;GOOGLE&quot; ...
#   ..$ types             :List of 20
#   ..$ user_ratings_total: int [1:20] 88 490 569 395 280 450 708 1243 87 264 ...
#   ..$ vicinity          : chr [1:20] &quot;300 East Main Street G, Carrboro&quot; &quot;100 East Franklin Street #300, Chapel Hill&quot; &quot;431 West Franklin Street #415, Chapel Hill&quot; &quot;110 East Main Street, Carrboro&quot; ...
#  $ status           : chr &quot;OK&quot;

tmp$status
# [1] &quot;OK&quot;

names(tmp$results) # Print the attributes in the response.
#  [1] &quot;geometry&quot;           &quot;icon&quot;               &quot;id&quot;                
#  [4] &quot;name&quot;               &quot;opening_hours&quot;      &quot;photos&quot;            
#  [7] &quot;place_id&quot;           &quot;plus_code&quot;          &quot;price_level&quot;       
# [10] &quot;rating&quot;             &quot;reference&quot;          &quot;scope&quot;             
# [13] &quot;types&quot;              &quot;user_ratings_total&quot; &quot;vicinity&quot;

restaurants &lt;- tmp$results # This is fine, only because the status is OK. </code></pre>
<p>One advantage of using the <code>fromJSON</code> from Jsonlite package instead of the <code>rjson</code> package is that the results are automatically a data frame. This makes it easier to work with. If you do use the <code>rjson::fromJSON</code> you will have to parse the list into a data frame.</p>
</div>
</div>
<div id="visualise-these-results" class="section level2">
<h2>Visualise these results</h2>
<pre class="r"><code>library(leaflet)


m &lt;-  leaflet(cbind(restaurants$geometry$location$lng, restaurants$geometry$location$lat)) %&gt;%
    addProviderTiles(providers$Stamen.TonerLines, group = &quot;Basemap&quot;) %&gt;%
    addProviderTiles(providers$Stamen.TonerLite, group = &quot;Basemap&quot;) %&gt;%
    addCircles(group = &quot;POI&quot;,popup = restaurants$name)%&gt;%
    addLayersControl(
        overlayGroups = c(&quot;POI&quot;, &#39;Basemap&#39;),
        options = layersControlOptions(collapsed = FALSE)
    )

m</code></pre>
<div id="htmlwidget-1" style="width:768px;height:480px;" class="leaflet html-widget"></div>
<script type="application/json" data-for="htmlwidget-1">{"x":{"options":{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}}},"calls":[{"method":"addProviderTiles","args":["Stamen.TonerLines",null,"Basemap",{"errorTileUrl":"","noWrap":false,"detectRetina":false}]},{"method":"addProviderTiles","args":["Stamen.TonerLite",null,"Basemap",{"errorTileUrl":"","noWrap":false,"detectRetina":false}]},{"method":"addCircles","args":[[35.9102012,35.9129465,35.9100322,35.9103912,35.9108731,35.910176,35.9115747,35.9113001,35.912013,35.9113783,35.910441,35.9106254,35.9102709,35.9117475,35.9134914,35.9069319,35.913727,35.9095986,35.9107746,35.91064],[-79.0685709,-79.0553581,-79.0628443,-79.0708835,-79.0689102,-79.062874,-79.0633682,-79.0610065,-79.0600363,-79.0589829,-79.062318,-79.0627303,-79.0691725,-79.0601652,-79.0543808,-79.0457779,-79.057954,-79.0644114,-79.062627,-79.0615332],10,null,"POI",{"interactive":true,"className":"","stroke":true,"color":"#03F","weight":5,"opacity":0.5,"fill":true,"fillColor":"#03F","fillOpacity":0.2},["Amante Gourmet Pizza - Carrboro","Top of the Hill Restaurant & Brewery","Vimala's Curryblossom Cafe","Acme Food & Beverage Co","Gourmet Kingdom","Kipos Greek Taverna","Mama Dip's Kitchen","Mediterranean Deli, Bakery, and Catering","Jimmy John's","Panera Bread","Lantern","Carolina Brewery","Oakleaf","CholaNad Restaurant & Bar","Carolina Coffee Shop","The Carolina Club","La Residence","Papa John's Pizza","Elaine's On Franklin","411 West Italian Cafe"],null,null,{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null,null]},{"method":"addLayersControl","args":[[],["POI","Basemap"],{"collapsed":false,"autoZIndex":true,"position":"topright"}]}],"limits":{"lat":[35.9069319,35.913727],"lng":[-79.0708835,-79.0457779]}},"evals":[],"jsHooks":[]}</script>
<hr />
<p><strong>Exercise</strong></p>
<ul>
<li>The query results only in 20 restaurants at the one time. But there is a next page token that allows you to query for more. Write a loop to continue to request more restaurants, until they are exhausted.
<ul>
<li>Make sure that you are not overloading the server and not going over your query limit. Implement sanity checks.</li>
<li>Make sure your loop recovers gracefully from any errors. Use TryCatch and check for status with each query.</li>
</ul></li>
<li><p>Instead of restaurants search for day care centers around UNC. What can you infer from the results?</p></li>
<li><p>Find all the fire stations in Orange county and store them on the disk. We will use this later.</p></li>
</ul>
<hr />
<p>The advantage of the above code is that it is generalisable. As long as the API has good documentation, you can adapt the code to extract information from it. In some instances, instead of JSON, XML output is generated. In such cases, it is customary to use <code>xml2</code> instead of <code>jsonlite</code> to convert to tables, tibbles and dataframes.</p>
<div id="using-prebuilt-packages" class="section level3">
<h3>Using prebuilt packages</h3>
<p>For common APIs, R has some convenience packages. For example, we can use <code>googleway</code> to access much of the google API functionality for users to access the Google Place API. According to its <a href="https://cran.r-project.org/web/packages/googleway/vignettes/googleway-vignette.html">package document</a></p>
<blockquote>
<p>Googleway provides access to Google Maps APIs, and the ability to plot an interactive Google Map overlayed with various layers and shapes, including markers, circles, rectangles, polygons, lines (polylines) and heatmaps. You can also overlay traffic information, transit and cycling routes.</p>
</blockquote>
<pre class="r"><code>library(googleway)
## not specifying the api will add the key as your &#39;default&#39;
## Set the key for the package to use
set_key(key = key)
#google_keys()  # Use this to find

## Send the Query
tmp &lt;- google_places(search_string = &quot;Restaurant&quot;, location = c(35.912073,-79.05123), radius = 2000, key = key)

## All the result is already compiled into a R dataframe for further analysis, which is much eaiser to manipulate later.
restaurants2 &lt;- tmp$results

restaurants2[, c(&#39;name&#39;, &#39;rating&#39;, &#39;price_level&#39;)] %&gt;% head()
#                          name rating price_level
# 1 City Bus Burritos and Tacos    4.7           1
# 2             Hops Burger Bar    4.7           2
# 3               Tacos El Niño    4.5          NA
# 4           Hibachi &amp; Company    4.6           1
# 5           Al&#39;s Burger Shack    4.7           1
# 6                      Tandem    4.5           3</code></pre>
<p>Googleway package has the abiltity to get more complicated data as well. For example, you can access the route between two points (say Old well to Southpoint mall)</p>
<pre class="r"><code>tmp &lt;- google_directions(origin = c(35.912073,-79.05123),
                         destination = c(35.90497, -78.946485),
                        mode = &quot;walking&quot;,
                         key = directionskey, # Make sure that your API key has directions enabled.
                         simplify = TRUE) %&gt;%
                    direction_polyline() %&gt;%
                    decode_pl() %&gt;%
                    .[,c(2,1)] %&gt;%
                    as.matrix() %&gt;% 
                    st_linestring() %&gt;%
                    st_sfc(crs=&quot;+init=epsg:4326&quot;) 

library(mapview)
mapview(tmp)</code></pre>
<div id="htmlwidget-2" style="width:768px;height:480px;" class="leaflet html-widget"></div>
<script type="application/json" data-for="htmlwidget-2">{"x":{"options":{"minZoom":1,"maxZoom":100,"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}},"preferCanvas":false,"bounceAtZoomLimits":false,"maxBounds":[[[-90,-370]],[[90,370]]]},"calls":[{"method":"addProviderTiles","args":["CartoDB.Positron",1,"CartoDB.Positron",{"errorTileUrl":"","noWrap":false,"detectRetina":false}]},{"method":"addProviderTiles","args":["CartoDB.DarkMatter",2,"CartoDB.DarkMatter",{"errorTileUrl":"","noWrap":false,"detectRetina":false}]},{"method":"addProviderTiles","args":["OpenStreetMap",3,"OpenStreetMap",{"errorTileUrl":"","noWrap":false,"detectRetina":false}]},{"method":"addProviderTiles","args":["Esri.WorldImagery",4,"Esri.WorldImagery",{"errorTileUrl":"","noWrap":false,"detectRetina":false}]},{"method":"addProviderTiles","args":["OpenTopoMap",5,"OpenTopoMap",{"errorTileUrl":"","noWrap":false,"detectRetina":false}]},{"method":"createMapPane","args":["line",430]},{"method":"addPolylines","args":[[[[{"lng":[-79.0512084960938,-79.0511779785156,-79.0511779785156,-79.0512008666992,-79.0512084960938,-79.0511703491211,-79.0510406494141,-79.0508117675781,-79.0505447387695,-79.050178527832,-79.0489349365234,-79.0478897094727,-79.0475616455078,-79.0473098754883,-79.0470504760742,-79.0466690063477,-79.0462417602539,-79.0457305908203,-79.0450668334961,-79.0445251464844,-79.0437316894531,-79.0432510375977,-79.0429763793945,-79.0427169799805,-79.0426483154297,-79.0422286987305,-79.0417709350586,-79.0410385131836,-79.0406646728516,-79.0401306152344,-79.0396881103516,-79.0393371582031,-79.0387115478516,-79.0385971069336,-79.0382766723633,-79.0379791259766,-79.0373992919922,-79.0370178222656,-79.036506652832,-79.0360260009766,-79.0356292724609,-79.0353012084961,-79.0352096557617,-79.0340042114258,-79.0331115722656,-79.0324249267578,-79.0312805175781,-79.0304565429688,-79.0298614501953,-79.0272598266602,-79.0238265991211,-79.0221481323242,-79.0214309692383,-79.0199813842773,-79.0175170898438,-79.0121154785156,-79.0088806152344,-79.0084686279297,-79.0080795288086,-79.0073394775391,-79.0070877075195,-79.0066604614258,-79.0062408447266,-79.005615234375,-79.0052947998047,-79.0037384033203,-79.0024948120117,-79.0017395019531,-79.0011367797852,-79.0005187988281,-78.9999694824219,-78.9995956420898,-78.9987945556641,-78.9979858398438,-78.9955291748047,-78.9948959350586,-78.9939575195312,-78.9931182861328,-78.9919052124023,-78.9905242919922,-78.9898910522461,-78.988166809082,-78.9870147705078,-78.9855270385742,-78.9847717285156,-78.9841766357422,-78.984016418457,-78.9834671020508,-78.9831695556641,-78.9820556640625,-78.981086730957,-78.9807586669922,-78.9806900024414,-78.9804382324219,-78.9800491333008,-78.9798049926758,-78.9794998168945,-78.9792098999023,-78.9774398803711,-78.9773254394531,-78.9768981933594,-78.9761810302734,-78.9741058349609,-78.9709854125977,-78.9675598144531,-78.9673004150391,-78.9662780761719,-78.9659271240234,-78.9658889770508,-78.9651107788086,-78.9645156860352,-78.9644088745117,-78.9642868041992,-78.9634780883789,-78.961784362793,-78.96142578125,-78.9609069824219,-78.9604873657227,-78.9595413208008,-78.9585266113281,-78.9578094482422,-78.9575958251953,-78.9573364257812,-78.9569091796875,-78.9563751220703,-78.9560470581055,-78.9553298950195,-78.952880859375,-78.9528579711914,-78.952278137207,-78.9514312744141,-78.9510192871094,-78.9508361816406,-78.9506378173828,-78.9502563476562,-78.9496994018555,-78.9492492675781,-78.949089050293,-78.9488906860352,-78.9486846923828,-78.9485015869141,-78.9482345581055,-78.9477844238281,-78.9472198486328,-78.9458084106445,-78.9459075927734,-78.9459075927734,-78.9458694458008,-78.9458084106445,-78.9457244873047,-78.9456100463867,-78.9455413818359,-78.9454650878906,-78.9453048706055,-78.9450988769531,-78.9449691772461,-78.9445495605469,-78.9437484741211,-78.9435577392578,-78.9431915283203,-78.9428787231445,-78.9426803588867,-78.9424667358398,-78.9421997070312,-78.9419784545898,-78.9418411254883,-78.9416885375977,-78.9417114257812,-78.9417266845703,-78.9417495727539,-78.9417877197266,-78.9419174194336,-78.943000793457,-78.943244934082,-78.9433364868164,-78.943359375,-78.9432373046875,-78.9430999755859,-78.9430770874023,-78.9430999755859,-78.9431610107422,-78.9432373046875,-78.9434967041016,-78.943717956543,-78.9439392089844,-78.9441604614258,-78.9444046020508,-78.9446792602539,-78.945068359375,-78.9451217651367,-78.9466705322266,-78.9467010498047,-78.9466781616211,-78.9465713500977],"lat":[35.9120979309082,35.9120674133301,35.9120292663574,35.9120101928711,35.9120101928711,35.9119186401367,35.9119606018066,35.9120483398438,35.9121475219727,35.9123001098633,35.912769317627,35.9131889343262,35.9132881164551,35.9133491516113,35.9133796691895,35.9134101867676,35.913387298584,35.9132881164551,35.9130897521973,35.912899017334,35.9125480651855,35.9122695922852,35.9120788574219,35.9118309020996,35.9117279052734,35.911319732666,35.9109382629395,35.9110794067383,35.9111099243164,35.9111480712891,35.9111595153809,35.9111404418945,35.9111175537109,35.9110908508301,35.9110679626465,35.9110298156738,35.9109191894531,35.9108085632324,35.9106178283691,35.9104385375977,35.9103393554688,35.910270690918,35.9102897644043,35.9101295471191,35.9100074768066,35.9099082946777,35.9096984863281,35.909538269043,35.9094009399414,35.9088478088379,35.9081001281738,35.9077072143555,35.9074783325195,35.9068794250488,35.905818939209,35.9035377502441,35.9021606445312,35.9020309448242,35.901927947998,35.9018173217773,35.901798248291,35.901798248291,35.9018287658691,35.9019393920898,35.9020080566406,35.902458190918,35.9028205871582,35.9030494689941,35.9032592773438,35.9035186767578,35.9037895202637,35.9039878845215,35.904468536377,35.9049606323242,35.9064407348633,35.9068298339844,35.9073677062988,35.9077682495117,35.9082984924316,35.9088973999023,35.9091491699219,35.9099082946777,35.9103889465332,35.9110794067383,35.9114875793457,35.9118194580078,35.9118385314941,35.9121894836426,35.9123878479004,35.9130973815918,35.9137687683105,35.913990020752,35.913990020752,35.9141006469727,35.9143104553223,35.9144096374512,35.9145202636719,35.9145889282227,35.9150390625,35.9151077270508,35.915210723877,35.9153900146484,35.9158897399902,35.9166374206543,35.9174690246582,35.9175109863281,35.9177398681641,35.9178199768066,35.9178581237793,35.9180488586426,35.9181900024414,35.9182205200195,35.9182090759277,35.9183502197266,35.9186973571777,35.9187507629395,35.9188575744629,35.9189987182617,35.9192085266113,35.9194107055664,35.919490814209,35.919490814209,35.919490814209,35.9194488525391,35.9193496704102,35.9192390441895,35.9189109802246,35.9175872802734,35.9175682067871,35.9172401428223,35.9166984558105,35.9163208007812,35.9161186218262,35.9158706665039,35.9153594970703,35.9144477844238,35.9137382507324,35.9135398864746,35.913330078125,35.9131507873535,35.9130172729492,35.9128608703613,35.9126586914062,35.9124908447266,35.9121894836426,35.9118385314941,35.9116401672363,35.9114379882812,35.9113082885742,35.911190032959,35.911060333252,35.9110374450684,35.9109573364258,35.9108390808105,35.9107284545898,35.9106903076172,35.9106903076172,35.9107780456543,35.9108009338379,35.9107894897461,35.9107208251953,35.9106407165527,35.9104690551758,35.9101905822754,35.9100799560547,35.9100303649902,35.9099998474121,35.9095497131348,35.9086380004883,35.9084892272949,35.9083976745605,35.9083404541016,35.9080696105957,35.9079895019531,35.9078598022461,35.9077072143555,35.9073600769043,35.9070205688477,35.906909942627,35.9067802429199,35.9066772460938,35.9066009521484,35.9064979553223,35.9064674377441,35.9064674377441,35.9064788818359,35.9064407348633,35.906379699707,35.9062995910645,35.9060401916504,35.9057197570801,35.905517578125,35.9053497314453,35.9049873352051]}]]],null,"tmp",{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}},"pane":"line","stroke":true,"color":"#6666ff","weight":2,"opacity":0.9,"fill":false,"fillColor":"#6666ff","fillOpacity":1,"smoothFactor":1,"noClip":false},null,{"maxWidth":800,"minWidth":50,"autoPan":true,"keepInView":false,"closeButton":true,"closeOnClick":true,"className":""},"1",{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},{"stroke":true,"weight":3,"opacity":1,"fill":false,"fillOpacity":0,"bringToFront":false,"sendToBack":false}]},{"method":"addScaleBar","args":[{"maxWidth":100,"metric":true,"imperial":true,"updateWhenIdle":true,"position":"bottomleft"}]},{"method":"addHomeButton","args":[-79.0512084960938,35.901798248291,-78.9416885375977,35.919490814209,"Zoom to tmp","<strong> tmp <\/strong>","bottomright"]},{"method":"addLayersControl","args":[["CartoDB.Positron","CartoDB.DarkMatter","OpenStreetMap","Esri.WorldImagery","OpenTopoMap"],"tmp",{"collapsed":true,"autoZIndex":true,"position":"topleft"}]}],"limits":{"lat":[35.901798248291,35.919490814209],"lng":[-79.0512084960938,-78.9416885375977]}},"evals":[],"jsHooks":{"render":[{"code":"function(el, x, data) {\n  return (\n      function(el, x, data) {\n      // get the leaflet map\n      var map = this; //HTMLWidgets.find('#' + el.id);\n      // we need a new div element because we have to handle\n      // the mouseover output separately\n      // debugger;\n      function addElement () {\n      // generate new div Element\n      var newDiv = $(document.createElement('div'));\n      // append at end of leaflet htmlwidget container\n      $(el).append(newDiv);\n      //provide ID and style\n      newDiv.addClass('lnlt');\n      newDiv.css({\n      'position': 'relative',\n      'bottomleft':  '0px',\n      'background-color': 'rgba(255, 255, 255, 0.7)',\n      'box-shadow': '0 0 2px #bbb',\n      'background-clip': 'padding-box',\n      'margin': '0',\n      'padding-left': '5px',\n      'color': '#333',\n      'font': '9px/1.5 \"Helvetica Neue\", Arial, Helvetica, sans-serif',\n      'z-index': '700',\n      });\n      return newDiv;\n      }\n\n\n      // check for already existing lnlt class to not duplicate\n      var lnlt = $(el).find('.lnlt');\n\n      if(!lnlt.length) {\n      lnlt = addElement();\n\n      // grab the special div we generated in the beginning\n      // and put the mousmove output there\n\n      map.on('mousemove', function (e) {\n      if (e.originalEvent.ctrlKey) {\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\n      lnlt.text(\n                           ' lon: ' + (e.latlng.lng).toFixed(5) +\n                           ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                           ' | zoom: ' + map.getZoom() +\n                           ' | x: ' + L.CRS.EPSG3857.project(e.latlng).x.toFixed(0) +\n                           ' | y: ' + L.CRS.EPSG3857.project(e.latlng).y.toFixed(0) +\n                           ' | epsg: 3857 ' +\n                           ' | proj4: +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs ');\n      } else {\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\n      lnlt.text(\n                      ' lon: ' + (e.latlng.lng).toFixed(5) +\n                      ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                      ' | zoom: ' + map.getZoom() + ' ');\n      }\n      });\n\n      // remove the lnlt div when mouse leaves map\n      map.on('mouseout', function (e) {\n      var strip = document.querySelector('.lnlt');\n      strip.remove();\n      });\n\n      };\n\n      //$(el).keypress(67, function(e) {\n      map.on('preclick', function(e) {\n      if (e.originalEvent.ctrlKey) {\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\n      lnlt.text(\n                      ' lon: ' + (e.latlng.lng).toFixed(5) +\n                      ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                      ' | zoom: ' + map.getZoom() + ' ');\n      var txt = document.querySelector('.lnlt').textContent;\n      console.log(txt);\n      //txt.innerText.focus();\n      //txt.select();\n      setClipboardText('\"' + txt + '\"');\n      }\n      });\n\n      //map.on('click', function (e) {\n      //  var txt = document.querySelector('.lnlt').textContent;\n      //  console.log(txt);\n      //  //txt.innerText.focus();\n      //  //txt.select();\n      //  setClipboardText(txt);\n      //});\n\n      function setClipboardText(text){\n      var id = 'mycustom-clipboard-textarea-hidden-id';\n      var existsTextarea = document.getElementById(id);\n\n      if(!existsTextarea){\n      console.log('Creating textarea');\n      var textarea = document.createElement('textarea');\n      textarea.id = id;\n      // Place in top-left corner of screen regardless of scroll position.\n      textarea.style.position = 'fixed';\n      textarea.style.top = 0;\n      textarea.style.left = 0;\n\n      // Ensure it has a small width and height. Setting to 1px / 1em\n      // doesn't work as this gives a negative w/h on some browsers.\n      textarea.style.width = '1px';\n      textarea.style.height = '1px';\n\n      // We don't need padding, reducing the size if it does flash render.\n      textarea.style.padding = 0;\n\n      // Clean up any borders.\n      textarea.style.border = 'none';\n      textarea.style.outline = 'none';\n      textarea.style.boxShadow = 'none';\n\n      // Avoid flash of white box if rendered for any reason.\n      textarea.style.background = 'transparent';\n      document.querySelector('body').appendChild(textarea);\n      console.log('The textarea now exists :)');\n      existsTextarea = document.getElementById(id);\n      }else{\n      console.log('The textarea already exists :3')\n      }\n\n      existsTextarea.value = text;\n      existsTextarea.select();\n\n      try {\n      var status = document.execCommand('copy');\n      if(!status){\n      console.error('Cannot copy text');\n      }else{\n      console.log('The text is now on the clipboard');\n      }\n      } catch (err) {\n      console.log('Unable to copy.');\n      }\n      }\n\n\n      }\n      ).call(this.getMap(), el, x, data);\n}","data":null}]}}</script>
<p>I recommend that you walk through the above code step by step. Especially notice how decoding a google encoded polyline results in a lat/lon data frame but sf wants a lon/lat data frame.</p>
<hr />
<p><strong>Exercise</strong></p>
<ul>
<li><p>For each centroid of block group in Orange County, NC, find and visualise the google recommended routes by walking, biking and driving to UNC campus. Draw conclusions about the efficacy of google’s directions.</p></li>
<li><p>Using Distance Matrix from Google, find the shortest distance from each centroid of the block group to each of the fire stations that you discovered earlier.</p></li>
</ul>
<p>You can use tigris package to download the blockgroup geometry from census.</p>
<hr />
</div>
</div>
</div>
<div id="collect-streetview-images-from-google" class="section level1">
<h1>Collect streetview images from Google</h1>
<p>In this section, we will use Google streeview API to download the streetview images around UNC. For more detailed information about how the API works, Please see the <a href="https://developers.google.com/maps/documentation/streetview/intro">documentation</a>.</p>
<p>There are two ways to send requests for streetview API, based on location or photoid. For this task we will use the location method to send the request.</p>
<p>Accoriding to the document:</p>
<blockquote>
<p>The Street View API will snap to the panorama photographed closest to this location. When an address text string is provided, the API may use a different camera location to better display the specified location. When a lat/lng is provided, the API searches a 50 meter radius for a photograph closest to this location. Because Street View imagery is periodically refreshed, and photographs may be taken from slightly different positions each time, it’s possible that your location may snap to a different panorama when imagery is updated.</p>
</blockquote>
<pre class="r"><code> 
#35.913697, -79.054205 &lt;- Franklin street coordinate
set_key(key = key)
# we use the google_streeview function in googleway package to compile the request url.
SearchURL &lt;- google_streetview(location =c(35.91357,-79.054596),key = directionskey, output = &quot;html&quot;)

library(httr)
library(jpeg)

#For image data, we need to use the GET function from httr package to extract the data
t &lt;- httr::GET(SearchURL)

#Save data using the writeJPEG function from jpeg package
writeJPEG(content(t),&quot;name.jpg&quot;)</code></pre>
<p>There are other parameters that can be manipulate the outcome such as size, heading, fov and pitch</p>
<blockquote>
<ul>
<li>size - numeric vector of length 2, specifying the output size of the image in pixels, given in width x height. For example, c(600, 400) returns an image 600 pixles wide and 400 pixles high.</li>
<li>heading - indicates the compass heading of the camera. Accepted values are from 0 to 360 (both 0 and 360 indicate north), 90 indicates east, 180 south and 270 west. If no heading is specified a value will be calculated that directs the camera to wards the specified location, from the point at which the closest photograph was taken.</li>
<li>fov - determines the horizontal field of view of the image. The field of view is expressed in degrees, with a maximum allowed value of 120. When dealing with a fixed-size viewport, as with Street View image of a set size, field of view in essence represents zoom, with small numbers indicating a higher level of zoom.</li>
<li>pitch - specifies the up or down angle of the camera relative to the Street View vehicle. This is often, but not always, flat horizontal. Positive values angle the camera up (with 90 degrees indicating straight up); negative values angle the camera down (with -90 indicating straight down)</li>
</ul>
</blockquote>
<hr />
<p><strong>Exercise</strong></p>
<ul>
<li>Download the streetview images from 20 random points near the fire stations around Orange County and store them. Use different parameters for same location and notice the differences. What impact does this have on analysis when you use them for say segmenting the street scene into % area covered in ‘trees’, ‘roads’, ‘buildings’, ‘store front’ etc.</li>
</ul>
<hr />
</div>
<div id="local-servers" class="section level1">
<h1>Local servers</h1>
<p>There is no reason to think that servers have to be remote. You can also query a local (on your computer) server and your R session acts like a client (e.g. browser). We can demonstrate this using OSRM server and constructing Isocrhrones. <a href="https://www.atlasobscura.com/articles/isochrone-maps-commutes-travel-times">Isochrones</a> are area you can reach from a point within a specified time. We can plot isochornes of every 2 min biking, around some random points in Orange County, NC For this we use the Open Source Routing Library (OSRM), though any other API works as well (e.g. Google, Mapbox etc. <a href="https://mrakow.wordpress.com/2015/11/30/isochrone-generation-with-the-google-maps-api-using-a-quadtree/">see this blog</a> for example.) .</p>
<p>For our purposes, we are going to <a href="https://github.com/Project-OSRM/osrm-backend">set up a OSRM server</a> on your computer.</p>
<ul>
<li>Different OS require different instructions, so please follow the <a href="https://github.com/Project-OSRM/osrm-backend">website</a> to construct the backend for your OS.</li>
<li>Download North Carolina road network from Openstreetmap from <a href="https://download.geofabrik.de/north-america.html">Geofabrik</a> for example (use the pbf file).</li>
<li>Construct a graph that can be used for finding shortest routes. Use suitably modified versions of
<ul>
<li>osrm-extract nc.osm.pbf -p ./profiles/bicycle.lua</li>
<li>osrm-partition nc.osrm</li>
<li>osrm-customize nc.osrm</li>
<li>osrm-routed –algorithm=MLD nc.osrm</li>
</ul></li>
</ul>
<p>in the command window/terminal (outside R). If all goes well, this sequence of steps will create local server ready to accept your requests. You can always shut it down by closing the terminal/command window, after you are done with your analysis. The server will be ready to be queried at <a href="http://localhost:5000/" class="uri">http://localhost:5000/</a> or <a href="http://127.0.0.1:5000" class="uri">http://127.0.0.1:5000</a></p>
<p>To get other modes, simply change the <code>lua</code> profile.</p>
<p>The following code is here for the sake of completeness and is not evaluated</p>
<pre class="r"><code>library(osrm)
# Ideally set these options up
 options(osrm.server = &quot;http://localhost:5000/&quot;)
options(osrm.profile = &#39;bike&#39;) 

randompoints &lt;- matrix(c( -79.065443, 35.924787, -79.087353, 35.914525, -79.066203, 35.881521), 
                       ncol=2, byrow =TRUE) %&gt;%
                      data.frame()
names(randompoints) &lt;- c(&#39;lng&#39;, &#39;lat&#39;)
randompoints$name &lt;- c(&#39;pt1&#39;, &#39;pt2&#39;, &#39;pt3&#39;)

rt &lt;- osrmRoute(src = randompoints[1,c(&#39;name&#39;, &#39;lng&#39;,&#39;lat&#39;)], 
                dst = randompoints[2,c(&#39;name&#39;,&#39;lng&#39;,&#39;lat&#39;)], 
                sp = TRUE) %&gt;% st_as_sf()

rt %&gt;% leaflet() %&gt;%
    addProviderTiles(providers$Stamen.TonerLines, group = &quot;Basemap&quot;) %&gt;%
  addProviderTiles(providers$Stamen.TonerLite, group = &quot;Basemap&quot;) %&gt;%
  addMarkers(data=randompoints[1:2,], ~lng, ~lat) %&gt;%
  addPolylines(weight =5, smoothFactor = .5, color=&#39;red&#39;)
</code></pre>
<p>OSRM is a convenience package that is wrapping the calls to the server and parsing the output into Spatial*. For example, the curl query in the backend looks like</p>
<p><code>http://localhost:5000/route/v1/biking/-78.901330,36.002806,-78.909020,36.040266</code></p>
<pre class="r"><code>iso &lt;- list()
for (i in 1:nrow(randompoints)){
iso[[i]] &lt;- osrmIsochrone(loc = randompoints[i,c(&#39;lng&#39;,&#39;lat&#39;)], breaks = seq(from = 0,to = 15, by = 2)) %&gt;% st_as_sf()
}

iso &lt;- do.call(&#39;rbind&#39;, iso)

 Npal &lt;- colorNumeric(
   palette = &quot;Reds&quot;, n = 5,
   domain = iso$center
 )
 
iso %&gt;% leaflet() %&gt;%
  addProviderTiles(providers$Stamen.TonerLines, group = &quot;Basemap&quot;) %&gt;%
  addProviderTiles(providers$Stamen.TonerLite, group = &quot;Basemap&quot;) %&gt;%
  addMarkers(data=randompoints, ~lng, ~lat) %&gt;%
  addPolygons(color = &quot;#444444&quot;, weight = 1, smoothFactor = 0.5,
    opacity = 1.0, fillOpacity = 0.5, fillColor = ~Npal(iso$center),
    group = &quot;Isochrone&quot;) %&gt;%
  addLegend(&quot;topleft&quot;, pal = Npal, values = ~iso$center,
            title = &quot;Biking Time (min)&quot;,opacity = 1
            )
</code></pre>
<p>The result should looks similar to the following.</p>
<p><img src="img/isochrones.png" style="width:200.0%;height:200.0%" /></p>
<hr />
<p><strong>Exercise</strong></p>
<ul>
<li>Find the areas of Orange county that are not within 15 minute response time of any of the fire station. By using the demographic information on the gaps, what conclusions can you draw ?</li>
</ul>
<hr />
</div>
<div id="unstructured-data" class="section level1">
<h1>Unstructured data</h1>
<p>JSON files are well-structured. Therefore, it is relatively easy to parse them. If the files are unstructured, a lot of effort goes into figuring out different structures and searches that will yield the dataset that is necessary. In general, packages such as <code>xml2</code> and <code>rvest</code> will help such tasks. This is left for a different day.</p>
</div>
<div id="conclusions" class="section level1">
<h1>Conclusions</h1>
<p>Reading data from server based APIs are no different from reading and parsing a local file. However, unlike local files that are well structured, and OS handling handling of low level functions of memory management and error recovery, we ought to be extra mindful of how errors might affect and break our code. Once the data is scraped, analysis proceeds in the usual fashion. However, because the data is not of specific vintage, reproducibility of research is a serious concern. You should note it and be able to provide archival of scraped data for others to use, subject to end use restrictions. In any case, currency of the data should be balanced with the archival mission of the organisation.</p>
</div>
<div id="acknowledgements" class="section level1">
<h1>Acknowledgements</h1>
<p>Parts of the code in this post is written by <a href="https://planning.unc.edu/student/chenyan/">Yan Chen</a>.</p>
</div>

    </div>

    


<div class="article-tags">
  
  <a class="badge badge-light" href="/tags/new-urban-analytics/">new-urban-analytics</a>
  
  <a class="badge badge-light" href="/tags/techniques-short-course/">techniques-short-course</a>
  
  <a class="badge badge-light" href="">Web 2.0</a>
  
</div>




    
      






  







<div class="media author-card" itemscope itemtype="http://schema.org/Person">
  
  
  <img class="portrait mr-3" src="/author/admin/avatar_hub3f48de923d36a3a7f2a35d484d2e93d_2804906_250x250_fill_q90_lanczos_center.jpg" itemprop="image" alt="Avatar">
  

  <div class="media-body">
    <h5 class="card-title" itemprop="name"><a href="/authors/admin">Nikhil Kaza</a></h5>
    <h6 class="card-subtitle">Associate Professor</h6>
    <p class="card-text" itemprop="description">My research interests include urbanization patterns, local energy policy and equity</p>
    <ul class="network-icon" aria-hidden="true">
      
      
      
      
        
      
      
      
      
      
      <li>
        <a itemprop="sameAs" href="mailto:nkaza[at]..unc%7bdot%7d%7dedu" >
          <i class="fas fa-paper-plane"></i>
        </a>
      </li>
      
      
      
      
        
      
      
      
      
      
        
      
      <li>
        <a itemprop="sameAs" href="https://twitter.com/nikhil_kaza" target="_blank" rel="noopener">
          <i class="fab fa-twitter"></i>
        </a>
      </li>
      
      
      
      
      
      
      
      
        
      
      <li>
        <a itemprop="sameAs" href="https://scholar.google.com/citations?user=F0FfN00AAAAJ" target="_blank" rel="noopener">
          <i class="ai ai-google-scholar"></i>
        </a>
      </li>
      
      
      
      
        
      
      
      
      
      
        
      
      <li>
        <a itemprop="sameAs" href="//github.com/nkaza" >
          <i class="fab fa-github"></i>
        </a>
      </li>
      
      
      
      
      
      
      
      
        
      
      <li>
        <a itemprop="sameAs" href="https://www.researchgate.net/profile/Nikhil_Kaza" target="_blank" rel="noopener">
          <i class="ai ai-researchgate"></i>
        </a>
      </li>
      
      
      
      
        
      
      
      
      
      
        
      
      <li>
        <a itemprop="sameAs" href="https://www.linkedin.com/in/nikhilkaza/" target="_blank" rel="noopener">
          <i class="fab fa-linkedin"></i>
        </a>
      </li>
      
    </ul>
  </div>
</div>



      
      
      <div class="article-widget">
        <div class="hr-light"></div>
        <h3>Related</h3>
        <ul>
          
          <li><a href="/post/2018-09-12-analysing-urban-neworks/analysing-urban-neworks/">Analysing Urban Neworks</a></li>
          
          <li><a href="/post/2018-08-07-machine-learning-for-remote-sensing/machine-learning-for-remote-sensing/">Machine Learning for Remote Sensing</a></li>
          
          <li><a href="/post/2018-08-03-scraping-web-for-data/scraping-web-for-data/">Scraping web for data</a></li>
          
          <li><a href="/post/2018-07-29-geospatial-data-in-r/geospatial-data-in-r/">Geospatial Data in R</a></li>
          
          <li><a href="/post/2018-07-26-introduction-to-r-exploratory-data-visualisation/introduction-to-r-exploratory-data-visualisation/">Introduction to R &amp; Exploratory Data Visualisation</a></li>
          
        </ul>
      </div>
      
    

    
    <div class="article-widget">
      <div class="post-nav">
  
  <div class="post-nav-item">
    <div class="meta-nav">Next</div>
    <a href="https://sia.planning.unc.edu/post/2018-09-24-using-network-ananlysis-to-identify-clusters-of-deprivation/using-network-ananlysis-to-identify-clusters-of-deprivation/" rel="next">Regions of Deprivation</a>
  </div>
  
  
  <div class="post-nav-item">
    <div class="meta-nav">Previous</div>
    <a href="https://sia.planning.unc.edu/post/2018-09-12-analysing-urban-neworks/analysing-urban-neworks/" rel="prev">Analysing Urban Neworks</a>
  </div>
  
</div>

    </div>
    

    


  </div>
</article>

<div class="container">
  <footer class="site-footer">
  
  <p class="powered-by">
    <a href="/privacy/">Privacy Policy</a>
  </p>
  

  <p class="powered-by">
    &copy;2019 Nikhil Kaza &middot; 

    Powered by the
    <a href="https://sourcethemes.com/academic/" target="_blank" rel="noopener">Academic theme</a> for
    <a href="https://gohugo.io" target="_blank" rel="noopener">Hugo</a>.

    
    <span class="float-right" aria-hidden="true">
      <a href="#" id="back_to_top">
        <span class="button_icon">
          <i class="fas fa-chevron-up fa-2x"></i>
        </span>
      </a>
    </span>
    
  </p>
</footer>

</div>


<div id="modal" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Cite</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <pre><code class="tex hljs"></code></pre>
      </div>
      <div class="modal-footer">
        <a class="btn btn-outline-primary my-1 js-copy-cite" href="#" target="_blank">
          <i class="fas fa-copy"></i> Copy
        </a>
        <a class="btn btn-outline-primary my-1 js-download-cite" href="#" target="_blank">
          <i class="fas fa-download"></i> Download
        </a>
        <div id="modal-error"></div>
      </div>
    </div>
  </div>
</div>

    

    
    
    
    <script src="/js/mathjax-config.js"></script>
    

    
    
    
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha512-+NqPlbbtM1QqiK8ZAo4Yrj2c4lNQoGv8P79DPtKzj++l5jnN39rHA/xsqn8zE9l0uSoxaCdrOgFs6yjyfbBxSg==" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.4/imagesloaded.pkgd.min.js" integrity="sha256-lqvxZrPLtfffUl2G/e7szqSvPBILGbwmsGE1MKlOi0Q=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/3.0.6/isotope.pkgd.min.js" integrity="sha256-CBrpuqrMhXwcLLUd5tvQ4euBHCdh7wGlDfNz8vbu/iI=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.js" integrity="sha256-X5PoE3KU5l+JcX+w09p/wHl9AzK333C4hJ2I9S5mD4M=" crossorigin="anonymous"></script>

      
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js" integrity="sha256-/BfiIkHlHoVihZdc6TFuj7MmJ0TWcWsMXkeDFwhi0zw=" crossorigin="anonymous"></script>
        
      

      
      
      <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-AMS_CHTML-full" integrity="sha256-GhM+5JHb6QUzOQPXSJLEWP7R73CbkisjzK5Eyij4U9w=" crossorigin="anonymous" async></script>
      
    

    
    

    
    
    

    
    
    <script>hljs.initHighlightingOnLoad();</script>
    

    

    
    

    

    
    

    
    

    
    
    
    
    
    
    
    
    
    
    
    
    <script src="/js/academic.min.d67d7e7d72a0d55e195559d9c7a3db66.js"></script>

  </body>
</html>

